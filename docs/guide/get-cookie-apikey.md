# 获取站点认证信息指南

本文档详细介绍了如何获取 PT 站点的认证信息（Cookie 或 API Key），这是使用 pt-tools 的前提条件。

[返回首页](../../README.md)

## 目录

- [认证方式概述](#认证方式概述)
- [方式一：使用浏览器扩展自动同步（推荐）](#方式一使用浏览器扩展自动同步推荐)
  - [安装扩展](#安装扩展)
  - [连接到 pt-tools](#连接到-pt-tools)
  - [同步单个站点 Cookie](#同步单个站点-cookie)
  - [批量同步所有站点 Cookie](#批量同步所有站点-cookie)
  - [开启自动同步](#开启自动同步)
- [方式二：手动获取认证信息](#方式二手动获取认证信息)
  - [Cookie 认证](#cookie-认证)
  - [API Key 认证](#api-key-认证)
- [在 pt-tools 中配置认证信息](#在-pt-tools-中配置认证信息)
- [认证方式对比](#认证方式对比)
- [常见问题排查](#常见问题排查)

## 认证方式概述

pt-tools 支持两种站点认证方式：

| 认证方式    | 适用站点                             | 特点                 | 推荐配置方式          |
| ----------- | ------------------------------------ | -------------------- | --------------------- |
| **Cookie**  | HDSky, SpringSunday, HDDolby, NovaHD | 传统方式，需定期更新 | ✅ 浏览器扩展自动同步 |
| **API Key** | M-Team                               | 长期有效             | 手动配置              |
| **Passkey** | Rousi Pro                            | 长期有效             | 手动配置              |

**Cookie 鉴权站点强烈推荐使用浏览器扩展**，可省去手动复制粘贴的繁琐操作，并在 Cookie 过期时自动更新。

---

## 方式一：使用浏览器扩展自动同步（推荐）

**PT Tools Helper** 浏览器扩展可在你登录 PT 站点后，一键将 Cookie 同步到 pt-tools，**无需打开开发者工具、无需手动复制粘贴**。

### 安装扩展

1. 从 [GitHub Releases](https://github.com/sunerpy/pt-tools/releases) 下载最新的 `pt-tools-helper.zip`
2. 解压到一个固定目录（不要解压后删除，浏览器需要持续读取）
3. 打开浏览器扩展管理页面：
   - Chrome → `chrome://extensions`
   - Edge → `edge://extensions`
4. 开启右上角「**开发者模式**」
5. 点击「**加载已解压的扩展程序**」，选择解压后的目录
6. 扩展图标出现在浏览器工具栏（一个翡翠色的 PT 图标）
7. 首次点击扩展图标，点击「**🔓 授权并启用**」授予所需权限

### 连接到 pt-tools

扩展需要知道 pt-tools 的地址才能同步 Cookie：

1. 点击浏览器工具栏的扩展图标
2. 在底部「**全局设置**」区域填写：
   - **pt-tools 地址**：你的 pt-tools 服务地址（如 `http://localhost:8080` 或 `http://192.168.1.100:8080`）
   - **用户名**（可选）：pt-tools 登录用户名
   - **密码**（可选）：pt-tools 登录密码
3. 点击「**🔗 连接测试**」确认连接成功
4. 连接成功后会显示「pt-tools 连接成功，设置已保存」

> 如果 pt-tools 运行在其他机器或 Docker 中，请确保填写的地址从当前浏览器可以访问。

### 同步单个站点 Cookie

1. 在浏览器中**正常登录** PT 站点（如 HDSky）
2. 点击扩展图标 → 会显示「**✅ HDSky (NexusPHP)**」
3. 确认 Cookie 状态显示「**有效**」
4. 点击「**🔄 同步 Cookie 到 pt-tools**」
5. 同步成功后显示确认消息

同步完成后，pt-tools 中该站点的 Cookie 配置会自动更新，无需在 pt-tools Web 界面手动填写。

### 批量同步所有站点 Cookie

如果你登录了多个 PT 站点，可以一次性同步所有站点的 Cookie：

1. 点击扩展图标
2. 展开底部「**全局设置**」
3. 在「**批量同步 Cookie**」区域可以看到所有内置站点
4. 每个站点旁边显示 Cookie 状态（有效/即将过期/缺失）
5. 勾选想要同步的站点（或点击「全选」）
6. 点击「**🔄 同步已选**」

> **注意**：使用 API Key 或 Passkey 的站点（如 M-Team、Rousi Pro）会显示为灰色不可选，这些站点需要在 pt-tools 中手动配置认证信息。

### 开启自动同步

开启自动同步后，当你在浏览器中访问 PT 站点时，Cookie 变更会自动推送到 pt-tools：

1. 访问一个 PT 站点
2. 点击扩展图标
3. 打开「**自动同步 Cookie**」开关

开启后，每次 Cookie 更新（如重新登录、Cookie 刷新）都会自动同步到 pt-tools。

---

## 方式二：手动获取认证信息

如果你不想安装浏览器扩展，或需要配置 API Key / Passkey 类型的站点，可以参考以下手动方法。

### Cookie 认证

#### 什么是 Cookie

Cookie 是网站存储在浏览器中的小段数据，用于维持用户的登录状态。PT 站点通过 Cookie 来识别已登录的用户身份。

**适用站点**：HDSky, SpringSunday, HDDolby, NovaHD 等基于 NexusPHP 架构的站点。

### Chrome / Edge 浏览器手动获取方法

**步骤 1：登录站点**

首先确保你已经登录目标 PT 站点，并且可以正常浏览页面。

**步骤 2：打开开发者工具**

使用以下任一方式打开开发者工具：

- 按键盘快捷键 `F12`
- 按 `Ctrl + Shift + I` (Windows/Linux) 或 `Cmd + Option + I` (Mac)
- 右键页面空白处，选择「检查」或「Inspect」

**步骤 3：切换到网络标签**

在开发者工具中，点击顶部的「Network」或「网络」标签。

**步骤 4：刷新页面**

按 `F5` 或点击浏览器刷新按钮，让开发者工具捕获网络请求。

**步骤 5：选择请求并复制 Cookie**

1. 在请求列表中，点击第一个请求（通常是页面本身）
2. 在右侧面板中，找到「Headers」或「标头」选项卡
3. 向下滚动找到「Request Headers」或「请求标头」
4. 找到 `Cookie` 字段
5. 复制整个 Cookie 值（通常很长，包含多个键值对）

**Cookie 示例格式**：

```
c_secure_uid=xxxxx; c_secure_pass=xxxxx; c_secure_ssl=xxxxx; c_secure_tracker_ssl=xxxxx
```

### Firefox 浏览器手动获取方法

**步骤 1-2**：与 Chrome 相同，登录站点后按 `F12` 打开开发者工具。

**步骤 3**：点击「网络」或「Network」标签。

**步骤 4**：刷新页面。

**步骤 5**：

1. 点击任意请求
2. 在右侧「消息头」中找到「请求头」
3. 复制 `Cookie` 字段的完整值

### Cookie 常见问题

**Q: Cookie 多久会失效？**

A: 大多数 PT 站点的 Cookie 有效期为 1-4 周不等。使用浏览器扩展并开启自动同步后，Cookie 更新会自动推送到 pt-tools，无需手动处理。

**Q: 如何延长 Cookie 有效期？**

A: 定期访问站点可以刷新 Cookie 有效期。部分站点的「记住我」选项可以延长有效期。配合扩展的自动同步功能，访问站点时 Cookie 会自动更新到 pt-tools。

**Q: Cookie 失效后怎么办？**

A:

- 使用扩展：重新登录站点，扩展自动检测并同步新 Cookie
- 手动方式：重新从浏览器获取新的 Cookie，在 pt-tools 中更新配置

**Q: 复制 Cookie 时需要注意什么？**

A:

- 确保复制完整的 Cookie 字符串，不要遗漏
- 不要包含 `Cookie:` 前缀，只复制值部分
- 避免复制时引入额外的空格或换行符

## API Key 认证

### 什么是 API Key

API Key 是站点为用户生成的专用访问令牌，相比 Cookie 具有以下优势：

- **长期有效**：不会像 Cookie 那样频繁过期
- **可随时撤销**：发现泄露后可以立即重新生成

**适用站点**：M-Team

### M-Team API Key 获取方法

**步骤 1：登录 M-Team**

使用浏览器登录 M-Team 站点。

**步骤 2：进入安全设置**

1. 点击右上角用户头像或用户名
2. 选择「控制面板」或「Settings」
3. 在左侧菜单找到「实验室」
4. 点击「存取令牌」

**步骤 3：生成 API Key**

1. 如果没有现成的 API Key，点击「生成新令牌」或「Create Token」
2. 为令牌设置一个名称（如 `pt-tools`），方便识别用途
3. 点击确认生成

**步骤 4：复制 API Key**

生成后，API Key 只会显示一次。请立即复制并妥善保存。

**API Key 示例格式**：

```
xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

### API Key 安全注意事项

1. **不要分享 API Key**：API Key 等同于你的账户密码
2. **及时撤销泄露的 Key**：如果怀疑 API Key 已泄露，立即在站点后台撤销并重新生成
3. **定期轮换**：建议每隔几个月更换一次 API Key
4. **不要提交到代码仓库**：使用环境变量或独立的配置文件存储

## 在 pt-tools 中配置认证信息

### 方式 A：通过浏览器扩展自动配置（Cookie 站点推荐）

使用浏览器扩展同步 Cookie 后，pt-tools 中对应站点的认证信息会**自动更新**，无需在 Web 界面手动操作。只需确保：

1. 扩展已连接到 pt-tools（参见上方[连接到 pt-tools](#连接到-pt-tools)）
2. 在扩展中点击「同步 Cookie」或已开启自动同步
3. pt-tools 站点列表中该站点已启用

### 方式 B：通过 Web 界面手动配置

1. 登录 pt-tools Web 管理界面
2. 进入「站点列表」页面
3. 找到目标站点，点击「编辑」或「启用」
4. 在认证信息字段中填入 Cookie 或 API Key
5. 点击「验证」按钮测试连接
6. 保存配置

### 配置验证

配置完成后，pt-tools 会自动测试认证信息是否有效：

| 状态         | 说明                        |
| ------------ | --------------------------- |
| **连接成功** | 认证信息有效，可正常使用    |
| **认证失败** | Cookie/API Key 无效或已过期 |
| **连接超时** | 网络问题，检查网络连接      |

## 认证方式对比

| 特性     | Cookie（扩展同步）  | Cookie（手动）       | API Key              |
| -------- | ------------------- | -------------------- | -------------------- |
| 获取难度 | ⭐ 极低（一键同步） | 较复杂（开发者工具） | 简单（站点后台生成） |
| 有效期   | 自动续期            | 1-4 周               | 长期有效             |
| 配置方式 | 扩展自动推送        | 手动粘贴             | 手动粘贴             |
| 安全性   | 一般                | 一般                 | 较高                 |
| 适用站点 | NexusPHP 架构       | NexusPHP 架构        | mTorrent 架构        |

## 常见问题排查

### 1. 提示「认证失败」

**可能原因**：

- Cookie/API Key 已过期或失效
- 复制时遗漏了部分内容
- 站点账号状态异常（如被封禁）

**解决方法**：

1. 重新登录站点，确认账号正常
2. 重新获取 Cookie 或 API Key
3. 确保复制完整，无多余空格

### 2. 提示「连接超时」

**可能原因**：

- 网络问题
- 站点维护或宕机
- 被防火墙拦截

**解决方法**：

1. 检查网络连接
2. 尝试用浏览器访问站点
3. 检查是否需要代理访问

### 3. Cookie 频繁失效

**推荐方案**：安装浏览器扩展并开启自动同步，Cookie 更新时自动推送到 pt-tools。

**手动处理时常见原因**：

- 站点安全策略较严格
- 长时间未访问站点
- 在其他设备登录导致被踢出

**解决方法**：

1. 定期访问站点保持活跃
2. 登录时勾选「记住我」选项
3. 避免同时在多设备登录

### 4. API Key 无法使用

**可能原因**：

- Key 已被撤销
- 权限不足
- 站点 API 服务异常

**解决方法**：

1. 检查站点后台，确认 Key 状态
2. 尝试重新生成新的 Key
3. 确认站点支持 API 访问

---

配置好认证信息后，下一步可以参考 [RSS 订阅配置指南](./rss-subscription.md) 设置自动下载。

[返回首页](../../README.md)
