# 获取站点认证信息指南

本文档详细介绍了如何获取 PT 站点的认证信息（Cookie 或 API Key），这是使用 pt-tools 的前提条件。

[返回首页](../../README.md)

## 目录

- [认证方式概述](#认证方式概述)
- [Cookie 认证](#cookie-认证)
    - [什么是 Cookie](#什么是-cookie)
    - [Edge/Chrome 浏览器获取方法](#chrome-浏览器获取方法)
    - [Firefox 浏览器获取方法](#firefox-浏览器获取方法)
    - [Cookie 常见问题](#cookie-常见问题)
- [API Key 认证](#api-key-认证)
    - [什么是 API Key](#什么是-api-key)
    - [M-Team API Key 获取方法](#m-team-api-key-获取方法)
    - [API Key 安全注意事项](#api-key-安全注意事项)
- [在 pt-tools 中配置认证信息](#在-pt-tools-中配置认证信息)
- [认证方式对比](#认证方式对比)
- [常见问题排查](#常见问题排查)

## 认证方式概述

pt-tools 支持两种站点认证方式：

| 认证方式    | 适用站点                     | 特点                 |
| ----------- | ---------------------------- | -------------------- |
| **Cookie**  | HDSky, SpringSunday, HDDolby | 传统方式，需定期更新 |
| **API Key** | M-Team                       | 长期有效             |

## Cookie 认证

### 什么是 Cookie

Cookie 是网站存储在浏览器中的小段数据，用于维持用户的登录状态。PT 站点通过 Cookie 来识别已登录的用户身份。

**适用站点**：HDSky, SpringSunday, HDDolby 等基于 NexusPHP 架构的站点。

### Chrome 浏览器获取方法

**步骤 1：登录站点**

首先确保你已经登录目标 PT 站点，并且可以正常浏览页面。

**步骤 2：打开开发者工具**

使用以下任一方式打开开发者工具：

- 按键盘快捷键 `F12`
- 按 `Ctrl + Shift + I` (Windows/Linux) 或 `Cmd + Option + I` (Mac)
- 右键页面空白处，选择「检查」或「Inspect」

**步骤 3：切换到网络标签**

在开发者工具中，点击顶部的「Network」或「网络」标签。

**步骤 4：刷新页面**

按 `F5` 或点击浏览器刷新按钮，让开发者工具捕获网络请求。

**步骤 5：选择请求并复制 Cookie**

1. 在请求列表中，点击第一个请求（通常是页面本身）
2. 在右侧面板中，找到「Headers」或「标头」选项卡
3. 向下滚动找到「Request Headers」或「请求标头」
4. 找到 `Cookie` 字段
5. 复制整个 Cookie 值（通常很长，包含多个键值对）

**Cookie 示例格式**：

```
c_secure_uid=xxxxx; c_secure_pass=xxxxx; c_secure_ssl=xxxxx; c_secure_tracker_ssl=xxxxx
```

### Firefox 浏览器获取方法

**步骤 1-2**：与 Chrome 相同，登录站点后按 `F12` 打开开发者工具。

**步骤 3**：点击「网络」或「Network」标签。

**步骤 4**：刷新页面。

**步骤 5**：

1. 点击任意请求
2. 在右侧「消息头」中找到「请求头」
3. 复制 `Cookie` 字段的完整值

### Cookie 常见问题

**Q: Cookie 多久会失效？**

A: 大多数 PT 站点的 Cookie 有效期为 1-4 周不等。如果长时间未访问站点，Cookie 可能会提前失效。

**Q: 如何延长 Cookie 有效期？**

A: 定期访问站点可以刷新 Cookie 有效期。部分站点的「记住我」选项可以延长有效期。

**Q: Cookie 失效后怎么办？**

A: 重新从浏览器获取新的 Cookie，并在 pt-tools 中更新配置。

**Q: 复制 Cookie 时需要注意什么？**

A:

- 确保复制完整的 Cookie 字符串，不要遗漏
- 不要包含 `Cookie:` 前缀，只复制值部分
- 避免复制时引入额外的空格或换行符

## API Key 认证

### 什么是 API Key

API Key 是站点为用户生成的专用访问令牌，相比 Cookie 具有以下优势：

- **长期有效**：不会像 Cookie 那样频繁过期
- **可随时撤销**：发现泄露后可以立即重新生成

**适用站点**：M-Team

### M-Team API Key 获取方法

**步骤 1：登录 M-Team**

使用浏览器登录 M-Team 站点。

**步骤 2：进入安全设置**

1. 点击右上角用户头像或用户名
2. 选择「控制面板」或「Settings」
3. 在左侧菜单找到「实验室」
4. 点击「存取令牌」

**步骤 3：生成 API Key**

1. 如果没有现成的 API Key，点击「生成新令牌」或「Create Token」
2. 为令牌设置一个名称（如 `pt-tools`），方便识别用途
3. 点击确认生成

**步骤 4：复制 API Key**

生成后，API Key 只会显示一次。请立即复制并妥善保存。

**API Key 示例格式**：

```
xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

### API Key 安全注意事项

1. **不要分享 API Key**：API Key 等同于你的账户密码
2. **及时撤销泄露的 Key**：如果怀疑 API Key 已泄露，立即在站点后台撤销并重新生成
3. **定期轮换**：建议每隔几个月更换一次 API Key
4. **不要提交到代码仓库**：使用环境变量或独立的配置文件存储

## 在 pt-tools 中配置认证信息

### 通过 Web 界面配置

1. 登录 pt-tools Web 管理界面
2. 进入「站点列表」页面
3. 找到目标站点，点击「编辑」或「启用」
4. 在认证信息字段中填入 Cookie 或 API Key
5. 点击「验证」按钮测试连接
6. 保存配置

### 配置验证

配置完成后，pt-tools 会自动测试认证信息是否有效：

| 状态         | 说明                        |
| ------------ | --------------------------- |
| **连接成功** | 认证信息有效，可正常使用    |
| **认证失败** | Cookie/API Key 无效或已过期 |
| **连接超时** | 网络问题，检查网络连接      |

## 认证方式对比

| 特性     | Cookie                 | API Key              |
| -------- | ---------------------- | -------------------- |
| 获取难度 | 较复杂（需开发者工具） | 简单（站点后台生成） |
| 有效期   | 1-4 周                 | 长期有效             |
| 安全性   | 一般                   | 较高                 |
| 权限范围 | 完整用户权限           | 可限制权限           |
| 泄露风险 | 可被用于完全冒充       | 可随时撤销           |
| 适用站点 | NexusPHP 架构          | mTorrent 架构        |

## 常见问题排查

### 1. 提示「认证失败」

**可能原因**：

- Cookie/API Key 已过期或失效
- 复制时遗漏了部分内容
- 站点账号状态异常（如被封禁）

**解决方法**：

1. 重新登录站点，确认账号正常
2. 重新获取 Cookie 或 API Key
3. 确保复制完整，无多余空格

### 2. 提示「连接超时」

**可能原因**：

- 网络问题
- 站点维护或宕机
- 被防火墙拦截

**解决方法**：

1. 检查网络连接
2. 尝试用浏览器访问站点
3. 检查是否需要代理访问

### 3. Cookie 频繁失效

**可能原因**：

- 站点安全策略较严格
- 长时间未访问站点
- 在其他设备登录导致被踢出

**解决方法**：

1. 定期访问站点保持活跃
2. 登录时勾选「记住我」选项
3. 避免同时在多设备登录

### 4. API Key 无法使用

**可能原因**：

- Key 已被撤销
- 权限不足
- 站点 API 服务异常

**解决方法**：

1. 检查站点后台，确认 Key 状态
2. 尝试重新生成新的 Key
3. 确认站点支持 API 访问

---

配置好认证信息后，下一步可以参考 [RSS 订阅配置指南](./rss-subscription.md) 设置自动下载。

[返回首页](../../README.md)
