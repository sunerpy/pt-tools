# 过滤规则与追剧指南

本文档详细介绍了如何使用 pt-tools 的过滤规则功能，实现自动追剧、下载特定资源等高级用法。

[返回首页](../../README.md)

## 目录

- [过滤规则概述](#过滤规则概述)
- [匹配模式详解](#匹配模式详解)
    - [关键词匹配](#关键词匹配)
    - [通配符匹配](#通配符匹配)
    - [正则表达式匹配](#正则表达式匹配)
- [过滤规则配置](#过滤规则配置)
- [追剧实战案例](#追剧实战案例)
    - [案例 1：追更特定剧集](#案例-1追更特定剧集)
    - [案例 2：只下载 4K 资源](#案例-2只下载-4k-资源)
    - [案例 3：指定字幕组/发布组](#案例-3指定字幕组发布组)
    - [案例 4：排除特定内容](#案例-4排除特定内容)
    - [案例 5：综合条件筛选](#案例-5综合条件筛选)
- [工作流程](#工作流程)
- [正则表达式速查](#正则表达式速查)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)

## 过滤规则概述

过滤规则是 pt-tools 的核心功能之一，它可以对 RSS 订阅中的种子进行精细化筛选，实现：

- **自动追剧**：只下载特定剧集的最新集数
- **质量筛选**：只下载 4K、1080p 等特定分辨率
- **来源筛选**：只下载特定字幕组或发布组的资源
- **免费优先**：默认只下载免费种子，节省下载量

**特色功能**：可配置下载符合过滤条件的**非免费种子**，适用于追更特定资源时不错过任何更新。

## 匹配模式详解

pt-tools 支持三种匹配模式，从简单到复杂：

| 模式           | 难度 | 适用场景     | 示例                 |
| -------------- | ---- | ------------ | -------------------- |
| **关键词**     | 简单 | 包含特定词汇 | `4K`, `REMUX`        |
| **通配符**     | 中等 | 简单模式匹配 | `*.2024.*`, `S01E??` |
| **正则表达式** | 复杂 | 精确复杂匹配 | `S\d{2}E\d{2}`       |

### 关键词匹配

最简单的匹配方式，只要标题或标签中包含指定关键词即匹配成功。

**语法**：直接输入关键词，多个关键词用逗号分隔

**匹配规则**：

- 不区分大小写
- 任一关键词匹配即成功（OR 关系）

**示例**：

```
4K,2160p,UHD
```

匹配结果：标题中包含 `4K` 或 `2160p` 或 `UHD` 的种子都会被匹配。

### 通配符匹配

使用 `*` 和 `?` 进行模式匹配，比关键词更灵活。

**语法**：

- `*` 匹配任意数量的任意字符
- `?` 匹配单个任意字符

**示例**：

| 模式                 | 说明           | 匹配示例                 |
| -------------------- | -------------- | ------------------------ |
| `*.2024.*`           | 包含 2024 年份 | `Movie.2024.1080p`       |
| `S01E??`             | 第一季任意集   | `S01E01`, `S01E12`       |
| `*REMUX*`            | 包含 REMUX     | `Movie.REMUX.2160p`      |
| `Show.Name.S??E??.*` | 任意季任意集   | `Show.Name.S02E05.1080p` |

### 正则表达式匹配

最强大的匹配方式，支持复杂的模式定义。

**常用语法**：

| 语法     | 说明               | 示例                    |
| -------- | ------------------ | ----------------------- |
| `\d`     | 匹配数字           | `\d` 匹配 `0-9`         |
| `\d{2}`  | 匹配两位数字       | `\d{2}` 匹配 `01`, `99` |
| `\d+`    | 匹配一个或多个数字 | `\d+` 匹配 `1`, `123`   |
| `.*`     | 匹配任意内容       | `A.*B` 匹配 `A123B`     |
| `(A\|B)` | 匹配 A 或 B        | `(4K\|2160p)`           |
| `^`      | 匹配开头           | `^Movie`                |
| `$`      | 匹配结尾           | `1080p$`                |

**常用模式**：

| 用途     | 正则表达式          | 匹配示例             |
| -------- | ------------------- | -------------------- |
| 剧集编号 | `S\d{2}E\d{2}`      | `S01E01`, `S02E15`   |
| 4K 资源  | `(4K\|2160p\|UHD)`  | `4K`, `2160p`        |
| 特定季   | `S01E\d{2}`         | `S01E01` 到 `S01E99` |
| 年份     | `\.(19\|20)\d{2}\.` | `.2024.`, `.1999.`   |

## 过滤规则配置

在 pt-tools Web 界面中创建过滤规则：

| 字段         | 说明           | 选项                         |
| ------------ | -------------- | ---------------------------- |
| **规则名称** | 规则的标识名称 | 如「追剧-某剧名」            |
| **匹配模式** | 选择匹配方式   | 关键词 / 通配符 / 正则表达式 |
| **匹配内容** | 要匹配的模式   | 根据模式填写                 |
| **匹配目标** | 匹配的字段     | 标题 / 标签 / 两者           |
| **要求免费** | 是否必须免费   | 是 / 否                      |
| **优先级**   | 规则优先级     | 数字越大优先级越高           |

**要求免费说明**：

- **是**：只下载免费种子，适合日常刷流
- **否**：即使非免费也下载，适合追更不想错过的内容

## 追剧实战案例

### 案例 1：追更特定剧集

**场景**：追更某部美剧第一季，不想错过任何更新。

**配置**：

```
规则名称: 追剧-某美剧S01
匹配模式: 正则表达式
匹配内容: 某美剧名称.*S01E\d{2}
匹配目标: 标题
要求免费: 否
```

**说明**：

- `某美剧名称.*S01E\d{2}` 会匹配如 `某美剧名称.S01E01.1080p.WEB-DL`
- 设置「要求免费」为「否」，确保即使非免费也能下载

### 案例 2：只下载 4K 资源

**场景**：只下载 4K/2160p 分辨率的电影资源。

**配置**：

```
规则名称: 4K电影
匹配模式: 关键词
匹配内容: 4K,2160p,UHD
匹配目标: 标题
要求免费: 是
```

**说明**：

- 使用关键词模式最简单
- 多个关键词是 OR 关系

### 案例 3：指定字幕组/发布组

**场景**：只下载特定字幕组的资源。

**配置**：

```
规则名称: 指定字幕组
匹配模式: 通配符
匹配内容: *SubGroup*
匹配目标: 标题
要求免费: 是
```

**或使用正则表达式**：

```
规则名称: 指定字幕组
匹配模式: 正则表达式
匹配内容: (SubGroup1|SubGroup2|SubGroup3)
匹配目标: 标题
要求免费: 是
```

### 案例 4：排除特定内容

**场景**：排除 HDSWEB 标签的种子。

**方法**：pt-tools 的过滤规则是「包含匹配」，如需排除特定内容，可以：

1. **利用站点 RSS 过滤**：在生成 RSS 链接时，选择不包含特定分类
2. **使用精确匹配**：只匹配需要的内容，而不是排除不需要的

**示例**：如果只想要 WEB-DL 而不要 HDTV：

```
规则名称: 只要WEB-DL
匹配模式: 关键词
匹配内容: WEB-DL,WEBDL,WEBRip
匹配目标: 标题
要求免费: 是
```

### 案例 5：综合条件筛选

**场景**：追更某剧的 4K 版本，由特定字幕组发布。

**配置**：

```
规则名称: 某剧-4K-字幕组
匹配模式: 正则表达式
匹配内容: 某剧名.*S01E\d{2}.*(2160p|4K).*SubGroup
匹配目标: 标题
要求免费: 否
```

**说明**：

- 正则表达式可以组合多个条件
- `.*` 用于匹配中间的任意内容

## 工作流程

```
RSS 订阅获取新种子
        |
        v
+------------------+
|   遍历过滤规则    |
| (按优先级排序)    |
+------------------+
        |
        v
+------------------+
|   匹配检查        |
| - 模式匹配        |
| - 目标字段匹配    |
+------------------+
        |
   匹配成功?
    /    \
   是     否
   |      |
   v      v
+------+ +------+
|免费   | |跳过  |
|检查   | |该种子|
+------+ +------+
   |
   v
要求免费 且 非免费?
    /    \
   是     否
   |      |
   v      v
+------+ +------+
|跳过  | |推送到|
|该种子| |下载器|
+------+ +------+
```

## 正则表达式速查

### 剧集匹配

| 需求             | 正则表达式              |
| ---------------- | ----------------------- |
| 任意剧集         | `S\d{2}E\d{2}`          |
| 第一季           | `S01E\d{2}`             |
| 第一季第1-9集    | `S01E0[1-9]`            |
| 第一季第10集以后 | `S01E(1[0-9]\|[2-9]\d)` |
| 季度合集         | `S\d{2}\.Complete`      |

### 质量匹配

| 需求       | 正则表达式                   |
| ---------- | ---------------------------- |
| 4K 资源    | `(4K\|2160p\|UHD)`           |
| 1080p 资源 | `1080p`                      |
| 高清资源   | `(1080p\|2160p\|4K)`         |
| REMUX      | `REMUX`                      |
| Blu-ray    | `(BluRay\|Blu-ray\|BDREMUX)` |

### 来源匹配

| 需求     | 正则表达式                |
| -------- | ------------------------- |
| WEB 资源 | `(WEB-DL\|WEBDL\|WEBRip)` |
| HDTV     | `HDTV`                    |
| 非 HDTV  | `WEB` (只匹配 WEB 类型)   |

## 最佳实践

### 1. 规则命名规范

使用清晰的命名方便管理：

- `追剧-剧名-季数`
- `4K-电影`
- `字幕组-组名`

### 2. 合理设置优先级

- 高优先级：追更特定内容（如正在追的剧）
- 中优先级：质量筛选规则
- 低优先级：通用规则

### 3. 渐进式配置

1. 先用简单的关键词规则测试
2. 确认匹配正确后再细化
3. 使用正则表达式进行精确控制

### 4. 定期维护

- 已完结的剧集：将规则设为禁用或删除
- 新季开播：更新规则中的季数
- 检查规则效果：确认没有误匹配

### 5. 配合 RSS 站点过滤

先在站点 RSS 设置中进行粗筛：

- 选择特定分类（电影、电视剧、动漫）
- 限制返回数量

然后用 pt-tools 过滤规则进行精筛。

## 常见问题

### Q: 为什么规则不生效？

A: 检查以下几点：

1. 规则是否已关联到 RSS 订阅
2. 匹配模式是否正确（注意转义字符）
3. 匹配目标是否选对（标题/标签）
4. 种子标题是否真的符合规则

### Q: 正则表达式如何调试？

A: 建议：

1. 过滤规则添加时，可以选择对应的RSS订阅然后点击测试查看返回的结果是否和预期一致
2. 先用简单模式，逐步增加复杂度
3. 查看 pt-tools 日志，确认匹配情况

### Q: 多个规则如何协同工作？

A: 过滤规则是 OR 关系：

- 种子匹配任一规则即会被下载
- 优先级高的规则先判断
- 一旦匹配成功，不再检查后续规则

### Q: 如何避免重复下载？

A: pt-tools 会自动记录已下载的种子：

- 相同种子不会重复下载
- 基于种子 hash 判断
- 历史记录保存在数据库中

### Q: 非免费下载会消耗多少流量？

A: 这取决于站点政策和种子大小：

- 请确保你有足够的下载额度
- 建议设置最大种子大小限制
- 追剧场景下，单集通常 2-10GB

---

更多配置详情请参考 [配置说明](../configuration.md)。

[返回首页](../../README.md)
